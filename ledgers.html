<!--
mdl-color-text--white   #ffffff
mdl-color--grey-50      #fafafa
mdl-color--grey-100     #f5f5f5
mdl-color--grey-900     #212121

mdl-color--red  #f44336
mdl-color--pink   #e91e63
mdl-color--purple  #9c27b0
mdl-color--deep-purple  #673ab7
mdl-color--indigo  #3f51b5
mdl-color--blue  #2196f3
mdl-color--light-blue  #03a9f4
mdl-color--cyan  #00bcd4
mdl-color--teal  #009688
mdl-color--green  #4caf50
mdl-color--light-green  #8bc34a
mdl-color--lime  #cddc39
mdl-color--yellow  #ffeb3b
mdl-color--amber  #ffc107
mdl-color--orange  #ff9800
mdl-color--deep-orange  #ff5722
mdl-color--brown  #795548
mdl-color--grey  #9e9e9e
mdl-color--blue-grey  #607d8b
mdl-color--black  #000000
mdl-color--white  #ffffff

mdl-color--red-A100 #ff8a80
mdl-color--red-A200 #ff5252
mdl-color--red-A400 #ff1744
mdl-color--red-A700 #d50000
mdl-color--pink-A100 #ff80ab
mdl-color--pink-A200 #ff4081
mdl-color--pink-A400 #f50057
mdl-color--pink-A700 #c51162
color--green-A100 #b9f6ca
color--green-A200 #69f0ae
color--green-A400 #00e676
color--green-A700 #00c853
mdl-color--light-green-A100 #ccff90
mdl-color--light-green-A200 #b2ff59
mdl-color--light-green-A400 #76ff03
mdl-color--light-green-A700 #64dd17
color--blue-A100 #82b1ff
color--blue-A200 #448aff
color--blue-A400 #2979ff
color--blue-A700 #2962ff
mdl-color--light-blue-A100 #80d8ff
mdl-color--light-blue-A200 #40c4ff
mdl-color--light-blue-A400 #00b0ff
mdl-color--light-blue-A700 #0091ea
mdl-color--purple-A100 #ea80fc
mdl-color--purple-A200 #e040fb
mdl-color--purple-A400 #d500f9
mdl-color--purple-A700 #aa00ff
mdl-color--deep-purple-A100 #b388ff
mdl-color--deep-purple-A200 #7c4dff
mdl-color--deep-purple-A400 #651fff
mdl-color--deep-purple-A700 #6200ea
mdl-color--indigo-A100 #8c9eff
mdl-color--indigo-A200 #536dfe
mdl-color--indigo-A400 #3d5afe
mdl-color--indigo-A700 #304ffe

mdl-color--primary
mdl-color--primary-dark
mdl-color--primary-contrast
mdl-color--accent
mdl-color--accent-dark
mdl-color--accent-contrast

mdl-typography--display-4
mdl-typography--display-3
mdl-typography--display-2
mdl-typography--display-1
mdl-typography--headline
mdl-typography--title
mdl-typography--subhead
mdl-typography--body-1
mdl-typography--body-2
mdl-typography--caption
mdl-typography--menu
mdl-typography--button

mdl-shadow--2dp
mdl-shadow--16dp

mdl-grid
mdl-grid--no-spacing

mdl-card__title
mdl-card__title-text
mdl-card__subtitle-text
mdl-card__supporting-text
mdl-card__media
mdl-card__actions
mdl-card__menu
mdl-card--border
mdl-card--expand

mdl-layout-spacer

MDL is about 200kb... That sucks!

MDL will automagically register and render all elements marked with MDL classes on page load.
But when you create DOM elements with JS, you need to register new elements using `upgradeElement()`

amcharts.com/
-->

<!doctype html>

<html lang='en'>

  <head>
    <title>Stellar Desk</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <meta name='keywords' content='stellar,desk,crypto,cryptocurrency'>
    <meta name='description' content='Stellar Desk | The dashboard for all things Stellar!'>
    <meta name='subject' content='Stellar'>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name='mobile-web-app-capable' content='yes'>

    <!-- Add to homescreen for Safari on iOS -->
    <meta name='apple-mobile-web-app-capable' content='yes'>
    <meta name='apple-mobile-web-app-status-bar-style' content='black'>
    <meta name='apple-mobile-web-app-title' content='Stellar Desk'>
    <link rel='apple-touch-icon-precomposed' href='favicon.png'>

    <!-- --------------------- -->
    <link rel='icon' href='favicon.png'>

    <link rel='stylesheet' href='https://fonts.googleapis.com/icon?family=Montserrat|Material+Icons'>
    <link rel='stylesheet' href='material.blue-red.min.css'>
    <link rel='stylesheet' href='style.css'>
    <style type="text/css">
      .mdl-card{ width:300px; margin:8px 0 8px 0; min-height:32px; }
      .mdl-card__title{ padding:16px 4px 4px 16px; }
      .mdl-card__title-text{ font:12px 'Montserrat';}
      .mdl-card__supporting-text{ font:bold 18px 'Montserrat'; font-weight:bold; padding:4px 4px 16px 16px; }
      .flex_justify_center{ display:flex; justify-content:center; }
    </style>

  </head>

  <body>

    <div class='mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer'>  <!-- 1. mdl-layout! -->

      <!-- ---------------------------------------------------------------------- -->
      <header class='mdl-layout__header'> <!-- 1.1 mdl-layout__header! -->
        <div class='mdl-layout__header-row'>

          <h1 id='title0' class='mdl-typography--title montserrat'>Stellar Desk<div id='clock0' class='clock'></div></h1>

          <div class='mdl-layout-spacer'></div>
          <button id='btn_horizon' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white'>testnet</button>

          <!-- <div class='mdl-layout-spacer'></div>
          <div class='mdl-textfield mdl-js-textfield mdl-textfield--expandable'>
            <label id='btn_search' class='mdl-button mdl-js-button mdl-button--icon' for='page_search'><i class='material-icons'>search</i></label>
            <div class='mdl-textfield__expandable-holder width256'>
              <input class='mdl-textfield__input text_search' id='page_search' type='text'/>
              <label class='mdl-textfield__label text_search' for='page_search'>Search ledger by <strong>sequence</strong></label>
            </div>
            <div class='mdl-tooltip mdl-tooltip--large' for='btn_search'>Search ledger by <strong>sequence</strong></div>
          </div>

          <!-- <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='hdrbtn'><i class='material-icons'>more_vert</i></button>
          <div class='mdl-tooltip mdl-tooltip--large' for='hdrbtn'>Panels</div>
          <ul id='nav1' class='mdl-menu mdl-js-menu mdl-js-ripple-effect mdl-menu--bottom-right' for='hdrbtn'>
            <a class='mdl-menu__item'>Item</a>
            <a class='mdl-menu__item'>Item</a>
          </ul> -->

        </div>
      </header>

      <!-- ---------------------------------------------------------------------- -->
      <div class='mdl-layout__drawer demo-drawer'> <!-- 1.2 mdl-layout__drawer! -->

        <header class='demo-drawer-header mdl-color--grey-900'>  <!-- Top-left dark corner! -->
          <img src='mathisart_small.png' class='demo-avatar'/>

          <div class='demo-avatar-dropdown'>
            <div class='mdl-layout-spacer'></div>
            <button id='accbtn' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color-text--white'><div class='material-icons'>arrow_drop_down</div></button>

            <ul class='mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect' for='accbtn'>
              <a class='mdl-menu__item' href='https://stellar.org'>Stellar.org</a>
              <a class='mdl-menu__item' href='https://www.stellar.org/developers/'>Developers</a>
              <a class='mdl-menu__item' href='https://github.com/stellar'>Github</a>
              <a class='mdl-menu__item' href='https://stellarchain.io/'>StellarChain</a>
              <a class='mdl-menu__item' href='https://galactictalk.org/'>Forums</a>
              <a class='mdl-menu__item' href='https://etale-cohomology.github.io/stellar-tutorials/'>Tutorials</a>
            </ul>
          </div>
        </header>

        <nav class='mdl-navigation mdl-color--blue'>
          <a class='mdl-navigation__link' href='accounts.html'><div class='material-icons'>accessibility</div>Accounts</a>
          <a class='mdl-navigation__link mdl-color--grey-900' href='ledgers.html'><div class='material-icons'>view_week</div>Ledgers</a>
          <a class='mdl-navigation__link' href='transactions.html'><div class='material-icons'>change_history</div>Transactions</a>
          <a class='mdl-navigation__link' href='operations.html'><div class='material-icons'>dashboard</div>Operations</a>
          <a class='mdl-navigation__link' href='effects.html'><div class='material-icons'>gesture</div>Effects</a>
          <a class='mdl-navigation__link' href='payments.html'><div class='material-icons'>payment</div>Payments</a>
          <hr class='mdl-color--white border_none'>
          <a class='mdl-navigation__link' href='markets.html'><div class='material-icons'>account_balance</div>Markets</a>
          <a class='mdl-navigation__link' href='wallet.html'><div class='material-icons'>fingerprint</div>Wallet</a>
          <!-- <a class='mdl-navigation__link' href='qourum.html'><div class='material-icons'>blur_circular</div>Quorum</a> -->
          <hr class='mdl-color--white border_none'>
          <a class='mdl-navigation__link' href='https://github.com/etale-cohomology/stellardesk'><div class='material-icons'>business</div>Source</a>
          <hr class='mdl-color--white border_none'>
          <!-- <a class='mdl-navigation__link' href='payments.html'><div class='material-icons'>payment</div>Trades</a> -->
          <!-- <hr class='mdl-color--white border_none'>
          <a class='mdl-navigation__link' href='poloniex.html'><div class='material-icons'>assessment</div>Poloniex</a>
          <a class='mdl-navigation__link' href='bittrex.html'><div class='material-icons'>assessment</div>Bittrex</a>
          <a class='mdl-navigation__link' href='kraken.html'><div class='material-icons'>assessment</div>Kraken</a> -->

          <!-- <div class='mdl-layout-spacer'></div>
          <a class='mdl-navigation__link' href=''><i class='material-icons'>help_outline</i></a> -->
        </nav>

      </div>

      <!-- ---------------------------------------------------------------------- -->
      <main class='mdl-layout__content mdl-color--grey-100'>  <!-- 1.3 mdl-layout__content! -->

        <div class='mdl-grid'>

          <div class='mdl-cell mdl-cell--12-col'>
            <h1 class='mdl-typography--title montserrat inline'>Ledgers</h1>
            <div id='spinner_main' class='mdl-spinner mdl-js-spinner margin_left4 is-active'></div>
          </div>

          <!-- <div class='mdl-cell mdl-cell--6-col'>
            <div class='mdl-card mdl-shadow--2dp inline'>Page XX</div>
            <button id='btn_prev' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised margin_left min_width'>Prev</button>
            <button id='btn_next' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--colored mdl-button--raised margin_left min_width'>Next</button>
          </div> -->

          <div class='mdl-cell mdl-cell--4-col flex_justify_center'>
            <div class='mdl-card mdl-shadow--2dp'> <!-- ------- -->
              <div class='mdl-card__title'><div id='ledgers_secs_title' class='mdl-card__title-text'>Avg. secs per ledger (last ? ledgers)</div></div>
              <div id='ledgers_secs' class='mdl-card__supporting-text'>NA</div>
            </div>
          </div>

          <div class='mdl-cell mdl-cell--4-col flex_justify_center'>
            <div class='mdl-card mdl-shadow--2dp'> <!-- ------- -->
              <div class='mdl-card__title'><div id='ledgers_txs_title' class='mdl-card__title-text'>Avg. transactions per ledger (last ? ledgers)</div></div>
              <div id='ledgers_txs' class='mdl-card__supporting-text'>NA</div>
            </div>
            </div>

          <div class='mdl-cell mdl-cell--4-col flex_justify_center'>
            <div class='mdl-card mdl-shadow--2dp'> <!-- ------- -->
              <div class='mdl-card__title'><div id='ledgers_ops_title' class='mdl-card__title-text'>Avg. operations per ledger (last ? ledgers)</div></div>
              <div id='ledgers_ops' class='mdl-card__supporting-text'>NA</div>
            </div>
          </div>

          <div class='mdl-cell mdl-cell--12-col'>
            <div class='horizontal_scroll'>
              <table id='ledgers_table' class='mdl-data-table mdl-js-data-table mdl-shadow--2dp hcenter'>
                <thead></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

        </div>

      </main>

    </div>

  </body>

  <script src='material.min.js'></script>
  <script src='stellar-sdk.min.js'></script>
  <script src='main.js'></script>
  <script>
    // ------------------------------------------------------------------------------------------------
    // Hide main title on search icon click!

    // let page_search = doc.querySelector('#page_search')
    // let title0 = doc.querySelector('#title0')

    // page_search.onfocus = function(event){
    //   title0.style.display = 'none'
    // }

    // page_search.onblur = function(event){
    //   title0.style.display = 'block'
    // }


    // ---------------------------------------------------------------------------------------------------
    // doc.querySelector('#btn_horizon').onclick = function(event){
    //   print(this.innerText, this.innerText == 'TESTNET')

    //   if(this.innerText == 'TESTNET'){
    //     HORIZON = new StellarSdk.Server(HORIZON_HOME)
    //     let ledger = new Ledger(null, 'desc', PARAM_LIMIT)
    //     ledgers_get(ledger)
    //     this.innerText = 'PUBNET'
    //   }
    //   else{
    //     HORIZON = new StellarSdk.Server(TESTNET_HOME)
    //     let ledger = new Ledger(null, 'desc', PARAM_LIMIT)
    //     ledgers_get(ledger)
    //     this.innerText = 'TESTNET'
    //   }
    // }

    // ---------------------------------------------------------------------------------------------------
    function Ledger(cursor=null, order=null, limit=null){
      this.cursor = cursor
      this.order = order
      this.limit = limit
    }

    function ledgers_get(ledger){
      HORIZON.ledgers().cursor(ledger.cursor).order(ledger.order).limit(ledger.limit).call().then(ledgers_callback).catch(error_show)
    }

    function ledgers_callback(response){
      ledger_stream_init(response)  // Start the streaming updates!
      table_head_build('#ledgers_table', LEDGERS_HEADERS)
      table_rows_build('#ledgers_table', PARAM_LIMIT)
      table_object_build('#ledgers_table', response.records, ledger_get, LEDGERS_HEADERS)  // Build initial table!
      spinner_disable('spinner_main')

      // --------------------- Add links!
      let rows = doc.querySelector('#ledgers_table').tBodies[0].rows
      for(let i=0; i<rows.length; ++i){
        let cells = rows[i].cells
        for(let j=0; j<cells.length; ++j)
          cells[j].innerHTML = `<a href='ledger.html?sequence=${response.records[i].sequence}'>${cells[j].innerText}</a>`
      }
    }

    function ledger_stream_init(response){
      let last_cursor = response.records[0].paging_token
      let ledger_eventsource = HORIZON.ledgers().cursor(last_cursor).order('asc').limit(1).stream({onmessage: ledger_stream})
    }

    function ledger_stream(response){
      table_object_update('#ledgers_table', response, ledger_get, LEDGERS_HEADERS)

      // --------------------- Add links!
      let cells = doc.querySelector('#ledgers_table').tBodies[0].rows[0].cells
      for(let i=0; i<cells.length; ++i)
        cells[i].innerHTML = `<a href='ledger.html?sequence=${response.sequence}'>${cells[i].innerText}</a>`

      // ---------------------
      let table_rows = doc.querySelector('#ledgers_table').tBodies[0].rows
      ledgers_avg_secs(table_rows)
      ledgers_avg_txs(table_rows)
      ledgers_avg_ops(table_rows)
    }

    // ----------------------------------------------------------------------
    function ledgers_avg_secs(table_rows){
      ledgers_secs = []
      for(let i=0; i < (table_rows.length-1); ++i){
        let secs = datestr_to_secs(table_rows[i].cells[0].innerText) - datestr_to_secs(table_rows[i+1].cells[0].innerText)
        ledgers_secs.push(secs)
      }
      doc.querySelector('#ledgers_secs_title').innerText = `Avg. seconds per ledger (last ${PARAM_LIMIT-1} ledgers)`
      doc.querySelector('#ledgers_secs').innerText = `${parseFloat(average(ledgers_secs)).toFixed(2)}`
    }

    function ledgers_avg_txs(table_rows){
      ledgers_txs = []
      for(let i=0; i < table_rows.length; ++i){
        let secs = parseInt(table_rows[i].cells[6].innerText)
        ledgers_txs.push(secs)
      }
      doc.querySelector('#ledgers_txs_title').innerText = `Avg. transactions per ledger (last ${PARAM_LIMIT} ledgers)`
      doc.querySelector('#ledgers_txs').innerText = `${parseFloat(average(ledgers_txs)).toFixed(2)}`
    }

    function ledgers_avg_ops(table_rows){
      ledgers_ops = []
      for(let i=0; i < table_rows.length; ++i){
        let secs = parseInt(table_rows[i].cells[7].innerText)
        ledgers_ops.push(secs)
      }
      doc.querySelector('#ledgers_ops_title').innerText = `Avg. operations per ledger (last ${PARAM_LIMIT} ledgers)`
      doc.querySelector('#ledgers_ops').innerText = `${parseFloat(average(ledgers_ops)).toFixed(2)}`
    }


    // ----------------------------------------------------------------------
    PARAM_LIMIT = 32
    let ledger = new Ledger(null, 'desc', PARAM_LIMIT)
    ledgers_get(ledger)
  </script>

</html>
