<!doctype html>

<html lang='en'>

  <head>
    <title>Stellar Desk</title>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>

    <meta name='description' content='Stellar Desk | The dashboard for all things Stellar!'>
    <meta name='subject' content='Stellar'>

    <!-- Add to homescreen for Chrome on Android -->
    <meta name='mobile-web-app-capable' content='yes'>

    <!-- Add to homescreen for Safari on iOS -->
    <meta name='apple-mobile-web-app-capable' content='yes'>
    <meta name='apple-mobile-web-app-status-bar-style' content='black'>
    <meta name='apple-mobile-web-app-title' content='Stellar Desk'>
    <link rel='apple-touch-icon-precomposed' href='favicon.png'>

    <link rel='icon' href='favicon.png'>
    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Montserrat|Material+Icons'>
    <link rel='stylesheet' href='material.blue-red.min.css'>
    <link rel='stylesheet' href='style.css'>
    <style>
      .mdl-card__supporting-text{ margin:0; padding:8px 0 0 8px; }

      .main_textfield{ width:90%; }
      @media screen and (max-width:414px){ .main_textfield{ width:80%; } }
    </style>
  </head>

  <body>

    <div class='mdl-layout mdl-js-layout mdl-layout--fixed-header mdl-layout--fixed-drawer'>

      <!-- ---------------------------------------------------------------------- -->
      <header class='mdl-layout__header'> <!-- 1.1 mdl-layout__header! -->
        <div class='mdl-layout__header-row'>

          <h1 id='title0' class='mdl-typography--title montserrat'>Stellar Desk<div id='clock0' class='clock'></div></h1>

          <div class='mdl-layout-spacer'></div>
          <button id='btn_horizon' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-color-text--white'>pubnet</button>

        </div>

        <div class='mdl-layout__tab-bar mdl-js-ripple-effect'>
          <a href='#panel0' class='mdl-layout__tab is-active'>Send lumens</a>
          <a href='#panel1' class='mdl-layout__tab'>Send asset</a>
          <a href='#panel2' class='mdl-layout__tab'>Trust asset</a>
          <a href='#panel3' class='mdl-layout__tab'>Generate account</a>
        </div>

      </header>

      <!-- ---------------------------------------------------------------------- -->
      <div class='mdl-layout__drawer demo-drawer'> <!-- 1.2 mdl-layout__drawer! -->

        <header class='demo-drawer-header mdl-color--grey-900'>  <!-- Top-left dark corner! -->
          <a href='/'><img src='mathisart_small.png' class='demo-avatar'/></a>

          <div class='demo-avatar-dropdown'>
            <div class='mdl-layout-spacer'></div>
            <button id='accbtn' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color-text--white'><div class='material-icons'>arrow_drop_down</div></button>

            <ul class='mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect' for='accbtn'>
              <a class='mdl-menu__item' href='https://stellar.org'>Stellar.org</a>
              <a class='mdl-menu__item' href='https://www.stellar.org/developers/'>Developers</a>
              <a class='mdl-menu__item' href='https://github.com/stellar'>Github</a>
              <a class='mdl-menu__item' href='https://stellarchain.io/'>StellarChain</a>
              <a class='mdl-menu__item' href='https://galactictalk.org/'>Forums</a>
              <a class='mdl-menu__item' href='https://etale-cohomology.github.io/stellar-tutorials/'>Tutorials</a>
            </ul>
          </div>
        </header>

        <nav class='mdl-navigation mdl-color--blue'>
          <a class='mdl-navigation__link' href='accounts?server=pubnet'><div class='material-icons'>accessibility</div>Accounts</a>
          <a class='mdl-navigation__link' href='ledgers?server=pubnet'><div class='material-icons'>view_week</div>Ledgers</a>
          <a class='mdl-navigation__link' href='transactions?server=pubnet'><div class='material-icons'>change_history</div>Transactions</a>
          <a class='mdl-navigation__link' href='operations?server=pubnet'><div class='material-icons'>dashboard</div>Operations</a>
          <a class='mdl-navigation__link' href='effects?server=pubnet'><div class='material-icons'>gesture</div>Effects</a>
          <a class='mdl-navigation__link' href='payments?server=pubnet'><div class='material-icons'>payment</div>Payments</a>
          <hr class='mdl-color--white border_none'>
          <a class='mdl-navigation__link' href='markets'><div class='material-icons'>account_balance</div>Markets</a>
          <a class='mdl-navigation__link mdl-color--grey-900' href='wallet?server=testnet'><div class='material-icons'>fingerprint</div>Wallet</a>
          <!-- <a class='mdl-navigation__link' href='qourum?server=pubnet'><div class='material-icons'>blur_circular</div>Quorum</a> -->
          <hr class='mdl-color--white border_none'>
          <a class='mdl-navigation__link' href='https://github.com/etale-cohomology/stellardesk'><div class='material-icons'>business</div>Source</a>
          <hr class='mdl-color--white border_none'>

          <!-- <div class='mdl-layout-spacer'></div>
          <a class='mdl-navigation__link' href=''><i class='material-icons'>help_outline</i></a> -->
        </nav>

      </div>

      <!-- ---------------------------------------------------------------------- -->
      <main class='mdl-layout__content'>

        <!-- --------------------- -->
        <section class='mdl-layout__tab-panel is-active' id='panel0'>
          <div class='mdl-grid margin_top6'>
            <div class='mdl-cell mdl-cell--8-col hcenter'>

              <div class='mdl-card mdl-shadow--2dp width_100'>

                <div class='mdl-card__title mdl-color--primary mdl-color-text--white'>
                  <h2 class='mdl-card__title-text'>Send Lumens</h2>
                  <div class='mdl-layout-spacer'></div>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment'><i class='material-icons'>help_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment'>Lumens are the native asset of the Stellar network. They have no issuer, and you don't need a trustline to hold Lumens.</div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_destination'><i class='material-icons'>person_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_destination'>ID of the account you're sending Lumens <b>to</b>. An account ID has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_destination'/>
                    <label class='mdl-textfield__label'>Destination account ID. <i>Example: GAUNTZ2Z2VFLMZEFHFWHUA4NEXOWSRSIKXD3OUA4S5BRTSWHQ354GMPN</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_amount'><i class='material-icons'>whatshot</i></button>
                  <div class='mdl-tooltip' for='help_payment_amount'>Amount of Lumens you want to send. Supports up to 7 digits to the right of the decimal point.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_amount'/>
                    <label class='mdl-textfield__label'>Amount. <i>Example: 999.1234567</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_seed'><i class='material-icons'>lock_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_seed'>Secret seed of the account you're sending Lumens <b>from</b>. An account secret seed has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='password' id='input_payment_seed'/>
                    <label class='mdl-textfield__label'>Sender's secret seed. <i>Example: SBZ27E7JWYPW2VGA2OT23TLV3OONAUHXCG6PUA565YR4KQTEMUT57IHP</i></label>
                  </div>
                </div>

                <div class='mdl-card__actions mdl-card--border vcenter_parent margin_top4'>
                  <div class='mdl-layout-spacer'></div>
                  <div id='spinner_payment_xlm' class='mdl-spinner mdl-js-spinner vcenter_child margin_right3'></div>
                  <button id='btn_payment_xlm' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--accent vcenter_child vcenter_parent'>submit payment<i class='material-icons vcenter_child margin_left4'>send</i></button>
                </div>

              </div>

            </div>
            </div>
        </section>

        <!-- --------------------- -->
        <section class='mdl-layout__tab-panel' id='panel1'>
          <div class='mdl-grid margin_top6'>
            <div class='mdl-cell mdl-cell--8-col hcenter'>

              <div class='mdl-card mdl-shadow--2dp width_100'>

                <div class='mdl-card__title mdl-color--primary mdl-color-text--white'>
                  <h2 class='mdl-card__title-text'>Send Asset</h2>
                  <div class='mdl-layout-spacer'></div>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asset'><i class='material-icons'>help_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_asset'>An asset is given by an asset code and an asset issuer. In order to send an asset to an account, that account must trust the asset. Go to the TRUST ASSET tab to trust an asset.</div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asset_destination'><i class='material-icons'>person_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_asset_destination'>ID of the account you're sending the asset <b>to</b>. An account ID has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_asset_destination'/>
                    <label class='mdl-textfield__label'>Destination account ID. <i>Example: GAUNTZ2Z2VFLMZEFHFWHUA4NEXOWSRSIKXD3OUA4S5BRTSWHQ354GMPN</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asset_code'><i class='material-icons'>group_work</i></button>
                  <div class='mdl-tooltip' for='help_payment_asset_code'>An asset code is a short identifier for an asset. By itself, it doesn't mean much, though. It needs to be paired with an <b>asset issuer</b>, since every asset on the Stellar network is issued by <i>some</i> account.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_asset_code'/>
                    <label class='mdl-textfield__label'>Asset code. <i>Example: ABC</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asser_issuer'><i class='material-icons'>gavel</i></button>
                  <div class='mdl-tooltip' for='help_payment_asser_issuer'>An asset issuer is an account that created and first sent an asset. Every asset issued by an account also has an <b>asset code</b> associated to it. Together, these 2 pieces of data serve to identify an asset.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_asset_issuer'/>
                    <label class='mdl-textfield__label'>Asset issuer. <i>Example: GDVGHCSB7E2YNOE6V7UUV753XCE72PZZAAUC2GISM7O43HRUD7WEO42L</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asset_amount'><i class='material-icons'>person_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_asset_amount'>Amount of the asset you want to send. Supports up to 7 digits to the right of the decimal point.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_payment_asset_amount'/>
                    <label class='mdl-textfield__label'>Amount. <i>Example: 999.1234567</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_payment_asset_seed'><i class='material-icons'>lock_outline</i></button>
                  <div class='mdl-tooltip' for='help_payment_asset_seed'>Secret seed of the account you're sending the asset <b>from</b>. An account secret seed has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='password' id='input_payment_asset_seed'/>
                    <label class='mdl-textfield__label'>Sender's secret seed. <i>Example: SBZ27E7JWYPW2VGA2OT23TLV3OONAUHXCG6PUA565YR4KQTEMUT57IHP</i></label>
                  </div>
                </div>

                <div class='mdl-card__actions mdl-card--border vcenter_parent margin_top4'>
                  <div class='mdl-layout-spacer'></div>
                  <div id='spinner_payment_asset' class='mdl-spinner mdl-js-spinner vcenter_child margin_right3'></div>
                  <button id='btn_payment_asset' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--accent vcenter_child'>submit payment<i class='material-icons vcenter_child margin_left4'>send</i></button>
                </div>

              </div>

            </div>
          </div>
        </section>

        <!-- --------------------- -->
        <section class='mdl-layout__tab-panel' id='panel2'>
          <div class='mdl-grid'>

            <!-- ------- -->
            <div class='mdl-cell mdl-cell--8-col margin_top6 hcenter'>

              <div class='mdl-card mdl-shadow--2dp width_100'>

                <div class='mdl-card__title mdl-color--primary mdl-color-text--white'>
                  <h2 class='mdl-card__title-text'>Trust Asset</h2>
                  <div class='mdl-layout-spacer'></div>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_trust'><i class='material-icons'>help_outline</i></button>
                  <div class='mdl-tooltip' for='help_trust'>In order to send an asset to an account, that account must trust the asset. An asset is given by an asset code and an asset issuer.</div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_input_trust_code'><i class='material-icons'>group_work</i></button>
                  <div class='mdl-tooltip' for='help_input_trust_code'>An asset code is a short identifier for an asset. By itself, it doesn't mean much, though. It needs to be paired with an <b>asset issuer</b>, since every asset on the Stellar network is issued by <i>some</i> account.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_trust_code'/>
                    <label class='mdl-textfield__label'>Asset code. <i>Example: ABC</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_input_trust_issuer'><i class='material-icons'>gavel</i></button>
                  <div class='mdl-tooltip' for='help_input_trust_issuer'>An asset issuer is an account that created and first sent an asset. Every asset issued by an account also has an <b>asset code</b> associated to it. Together, these 2 pieces of data serve to identify an asset.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_trust_issuer'/>
                    <label class='mdl-textfield__label'>Asset issuer. <i>Example: GDVGHCSB7E2YNOE6V7UUV753XCE72PZZAAUC2GISM7O43HRUD7WEO42L</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_input_trust_seed'><i class='material-icons'>lock_outline</i></button>
                  <div class='mdl-tooltip' for='help_input_trust_seed'>Secret seed of the account that's <b>trusting</b> the asset. An account secret seed has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='password' id='input_trust_seed'/>
                    <label class='mdl-textfield__label'>Sender's secret seed. <i>Example: SBZ27E7JWYPW2VGA2OT23TLV3OONAUHXCG6PUA565YR4KQTEMUT57IHP</i></label>
                  </div>
                </div>

                <div class='mdl-card__actions mdl-card--border vcenter_parent margin_top4'>
                  <div class='mdl-layout-spacer'></div>
                  <div id='spinner_trust' class='mdl-spinner mdl-js-spinner vcenter_child margin_right3'></div>
                  <button id='btn_trust' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--accent vcenter_child'>create trustline<i class='material-icons vcenter_child margin_left4'>send</i></button>
                </div>

              </div>

            </div>

            <!-- ------- -->
            <div class='mdl-cell mdl-cell--8-col margin_top6 hcenter'>

              <div class='mdl-card mdl-shadow--2dp width_100'>

                <div class='mdl-card__title mdl-color--primary mdl-color-text--white'>
                  <h2 class='mdl-card__title-text'>Stop trusting Asset</h2>
                  <div class='mdl-layout-spacer'></div>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_untrust'><i class='material-icons'>help_outline</i></button>
                  <div class='mdl-tooltip' for='help_untrust'>Use this panel to remove trust from an asset. An asset is given by an asset code and an asset issuer.</div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_untrust_code'><i class='material-icons'>group_work</i></button>
                  <div class='mdl-tooltip' for='help_untrust_code'>An asset code is a short identifier for an asset. By itself, it doesn't mean much, though. It needs to be paired with an <b>asset issuer</b>, since every asset on the Stellar network is issued by <i>some</i> account.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_untrust_code'/>
                    <label class='mdl-textfield__label'>Asset code. <i>Example: ABC</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_untrust_issuer'><i class='material-icons'>gavel</i></button>
                  <div class='mdl-tooltip' for='help_untrust_issuer'>An asset issuer is an account that created and first sent an asset. Every asset issued by an account also has an <b>asset code</b> associated to it. Together, these 2 pieces of data serve to identify an asset.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='text' id='input_untrust_issuer'/>
                    <label class='mdl-textfield__label'>Asset issuer. <i>Example: GDVGHCSB7E2YNOE6V7UUV753XCE72PZZAAUC2GISM7O43HRUD7WEO42L</i></label>
                  </div>
                </div>

                <div class='mdl-card__supporting-text width_100'>
                  <button class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon' id='help_untrust_seed'><i class='material-icons'>lock_outline</i></button>
                  <div class='mdl-tooltip' for='help_untrust_seed'>Secret seed of the account that's <i>no longer</i> <b>trusting</b> the asset. An account secret seed has 56 characters.</div>
                  <div class='mdl-textfield mdl-js-textfield main_textfield'>
                    <input class='mdl-textfield__input' type='password' id='input_untrust_seed'/>
                    <label class='mdl-textfield__label'>Sender's secret seed. <i>Example: SBZ27E7JWYPW2VGA2OT23TLV3OONAUHXCG6PUA565YR4KQTEMUT57IHP</i></label>
                  </div>
                </div>

                <div class='mdl-card__actions mdl-card--border vcenter_parent margin_top4'>
                  <div class='mdl-layout-spacer'></div>
                  <div id='spinner_untrust' class='mdl-spinner mdl-js-spinner vcenter_child margin_right3'></div>
                  <button id='btn_untrust' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--accent vcenter_child'>delete trustline<i class='material-icons vcenter_child margin_left4'>send</i></button>
                </div>

              </div>

            </div>

          </div>  <!-- END trust grid -->
        </section>

        <!-- --------------------- -->
        <section class='mdl-layout__tab-panel' id='panel3'> 
          <div class='mdl-grid margin_top6'>

            <!-- ------- -->
            <div class='mdl-cell mdl-cell--8-col hcenter'>
              <button id='btn_generated_account' class='mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--raised mdl-button--accent'>Generate account keys</button>
            </div>

            <div class='mdl-cell mdl-cell--8-col hcenter horizontal_scroll'>
              <table id='keypair_table' class='mdl-data-table mdl-js-data-table mdl-shadow--2dp margin_top4 hide'>
                <tbody>
                  <tr><th>Account ID</th><td id='pair_id'></td></tr>
                  <tr><th>Account secret seed</th><td id='pair_seed'></td></tr>
                </tbody>
              </table>
            </div>

          </div>
        </section>

        <!-- --------------------- -->
        <div id='snackbar_error' class='mdl-snackbar mdl-js-snackbar mdl-color--red'>  <!-- Snackbar for error! -->
          <div class='mdl-snackbar__text'></div><button class='mdl-snackbar__action' type='button'></button>
        </div>

        <div id='snackbar_success' class='mdl-snackbar mdl-js-snackbar mdl-color--green'>  <!-- Snackbar for success! -->
          <div class='mdl-snackbar__text'></div><button class='mdl-snackbar__action' type='button'></button>
        </div>


      </main>

    </div>

  </body>

  <script src='stellar-sdk.min.js'></script>
  <script src='material.min.js'></script>
  <script src='main.js'></script>
  <script>
    // ---------------------------------------------------------------------------------------------------
    let btn_generated_account = doc.querySelector('#btn_generated_account')
    btn_generated_account.onclick =     function(){
      doc.querySelector('#keypair_table').classList.remove('hide')

      var keypair = StellarSdk.Keypair.random()
      doc.querySelector('#pair_id').innerText = keypair.accountId()
      doc.querySelector('#pair_seed').innerText = keypair.seed()
    }


    // ---------------------------------------------------------------------------------------------------
    function payment_xlm_execute(){
      btn_disable('btn_payment_xlm')
      spinner_enable('spinner_payment_xlm')

      let account0_seed = doc.querySelector('#input_payment_seed').value
      let account0_id
      try{
        account0_id = StellarSdk.Keypair.fromSeed(account0_seed).accountId()
      }catch(error){
        payment_xlm_error(error, 'Error: invalid secret seed')
        return
      }
      account0_seed = undefined

      HORIZON.loadAccount(account0_id).then(payment_xlm_callback)
    }

    function payment_xlm_callback(account){
      let account0 = new StellarSdk.Account(account.id, account.sequence)
      let account1_id = doc.querySelector('#input_payment_destination').value
      let amount = doc.querySelector('#input_payment_amount').value
      let account0_seed = doc.querySelector('#input_payment_seed').value

      try{
        payment_xlm(account1_id, amount, account0, account0_seed)
        account0_seed = undefined
      }catch(error){
        generic_error_snackbar_show(error)
        btn_enable('btn_payment_xlm')
        spinner_disable('spinner_payment_xlm')
      }
    }

    function payment_xlm(account1_id, amount, account0, account0_seed){
      let tx = {destination: account1_id,
                asset: StellarSdk.Asset.native(),
                amount: amount}
      let operation = StellarSdk.Operation.payment(tx)
      let transaction = new StellarSdk.TransactionBuilder(account0).addOperation(operation).build()  // 1. Build transaction!
      transaction.sign(StellarSdk.Keypair.fromSeed(account0_seed))  // 2. Sign transaction!
      HORIZON.submitTransaction(transaction).then(payment_xlm_success).catch(payment_xlm_error)  // 3. Submit transaction!
      account0_seed = undefined
    }

    function payment_xlm_success(operation){
      btn_enable('btn_payment_xlm')
      spinner_disable('spinner_payment_xlm')

      let snackbar_div = doc.querySelector('#snackbar_success')
      let snackbar_data = {message: 'Payment success!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)
      doc.querySelector('#input_payment_seed').value = ''

      print(arguments.callee.name, operation)
    }

    function payment_xlm_error(error, msg){
      btn_enable('btn_payment_xlm')
      spinner_disable('spinner_payment_xlm')

      let snackbar_div = doc.querySelector('#snackbar_error')
      let snackbar_data = {message: msg ? msg : 'Payment failed!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)

      print(error.detail, error)
    }


    // ---------------------------------------------------------------------------------------------------
    // ID   GAECJVZ55YDSVO7KYNWSTFFTGF4AJ7DJH6O6WTTR33KCA2UBT4KOKBLY
    // seed SAUI2E4EM7UW6PZ6FWXNRZC7GOTTHQHECXMQFWYVY43XCN7CLGRGEXWG

    // ID   GDRTRNSP7T33KH3UYXX4I6I42ZVCKVYJ5P2W3KIJCYFK7IPLHOU7HZYJ
    // seed SCHNDPDUBW44G4BJCGORKR7LJCN77EMZZOFYLRGZUHTABNFP7XOZ5J5M

    // ID   GAPFRGD6WLIS3INGOFCFQFYZF3ESLXFGYZONZIKVCVBYXIYUEKZZD4CG
    // seed SB6K6MC6LD3FCZ4VSXGYB2IT7MJACQ4SHVUQ74VWQLMJEAGACI5JOCQU

    function payment_asset_execute(){
      btn_disable('btn_payment_asset')
      spinner_enable('spinner_payment_asset')

      let account0_seed = doc.querySelector('#input_payment_asset_seed').value
      let account0_id
      try{
        account0_id = StellarSdk.Keypair.fromSeed(account0_seed).accountId()
      }catch(error){
        payment_asset_error(error, 'Error: invalid secret seed')
        return
      }
      account0_seed = undefined

      HORIZON.loadAccount(account0_id).then(payment_asset_callback)
    }

    function payment_asset_callback(account){
      let account0 = new StellarSdk.Account(account.id, account.sequence)
      let account1_id = doc.querySelector('#input_payment_asset_destination').value
      let amount = doc.querySelector('#input_payment_asset_amount').value
      let asset_code = doc.querySelector('#input_payment_asset_code').value
      let asset_issuer = doc.querySelector('#input_payment_asset_issuer').value
      let account0_seed = doc.querySelector('#input_payment_asset_seed').value

      // -------
      if(asset_code.length == 0){
        account_seed = undefined
        error = 'Error: asset code can\'t be null'
        payment_asset_error(error, error)
        return
      }

      let asset
      try{
        asset =  new StellarSdk.Asset(asset_code, asset_issuer)
      }
      catch(error){
        payment_asset_error(error, error)
        account0_seed = undefined
      }

      // ------- TODO. Check for existing trustline!
      // let trust_flag = account.balances.some(trust_check)
      // if(!trust_flag){
      //   payment_asset_error(error, 'Error: destination account doesn\'t trust the asset!')
      //   account0_seed = undefined
      //   return
      // }

      // -------
      try{
        let tx = {destination: account1_id,
                  asset: asset,
                  amount: amount}
        let payment = StellarSdk.Operation.payment(tx)
        let transaction = new StellarSdk.TransactionBuilder(account0).addOperation(payment).build()  // 1. Build transaction!
        transaction.sign(StellarSdk.Keypair.fromSeed(account0_seed))  // 2. Sign transaction!
        HORIZON.submitTransaction(transaction).then(payment_asset_success).catch(payment_asset_error)  // 3. Submit transaction!
        account0_seed = undefined
      }catch(error){
        generic_error_snackbar_show(error)
        btn_enable('btn_payment_asset')
        spinner_disable('spinner_payment_asset')
      }
    }

    function payment_asset_success(operation){
      btn_enable('btn_payment_asset')
      spinner_disable('spinner_payment_asset')

      let snackbar_div = doc.querySelector('#snackbar_success')
      let snackbar_data = {message: 'Payment success!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)
      doc.querySelector('#input_payment_asset_seed').value = ''

      print(arguments.callee.name, operation)
    }

    function payment_asset_error(error, msg){
      btn_enable('btn_payment_asset')
      spinner_disable('spinner_payment_asset')

      let snackbar_div = doc.querySelector('#snackbar_error')
      let snackbar_data = {message: msg ? msg : 'Payment failed!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)

      print(error.detail, error)
    }

    function trust_check(balance){
      return balance.asset_code == asset.asset_code && balance.asser_issuer == asset.asset_issuer
    }

    // ---------------------------------------------------------------------------------------------------
    function create_trust_execute(){
      btn_disable('btn_trust')
      spinner_enable('spinner_trust')

      let account_seed = doc.querySelector('#input_trust_seed').value
      let account_id
      try{
        account_id = StellarSdk.Keypair.fromSeed(account_seed).accountId()
      }catch(error){
        create_trust_error(error, 'Error: invalid secret seed')
        return
      }
      account_seed = undefined

      HORIZON.loadAccount(account_id).then(create_trust_callback)
    }

    function create_trust_callback(account){
      account = new StellarSdk.Account(account.id, account.sequence)
      let account_seed = doc.querySelector('#input_trust_seed').value
      let asset_code = doc.querySelector('#input_trust_code').value
      let asset_issuer = doc.querySelector('#input_trust_issuer').value

      // -------
      if(asset_code.length == 0){
        account_seed = undefined
        error = 'Error: asset code can\'t be null'
        create_trust_error(error, error)
        return
      }

      let asset
      try{
        asset = new StellarSdk.Asset(asset_code, asset_issuer)
      }
      catch(error){
        create_trust_error(error, error)
        account_seed = undefined
      }

      // -------
      try{
        create_trust(account, account_seed, asset)
        account_seed = undefined
      }catch(error){
        generic_error_snackbar_show(error)
        btn_enable('btn_trust')
        spinner_disable('spinner_trust')
      }

    }

    function create_trust(account, account_seed, asset){
      let tx = {asset: asset}
      let operation = StellarSdk.Operation.changeTrust(tx)
      let transaction = new StellarSdk.TransactionBuilder(account).addOperation(operation).build()  // 1. Build transaction!
      transaction.sign(StellarSdk.Keypair.fromSeed(account_seed))  // 2. Sign transaction!
      HORIZON.submitTransaction(transaction).then(create_trust_success).catch(create_trust_error)  // 3. Submit transaction!
      account_seed = undefined
    }

    function create_trust_success(operation){
      btn_enable('btn_trust')
      spinner_disable('spinner_trust')

      let snackbar_div = doc.querySelector('#snackbar_success')
      let snackbar_data = {message: 'Trustline created!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)
      doc.querySelector('#input_trust_seed').value = ''

      print(arguments.callee.name, operation)
    }

    function create_trust_error(error, msg){
      btn_enable('btn_trust')
      spinner_disable('spinner_trust')

      let snackbar_div = doc.querySelector('#snackbar_error')
      let snackbar_data = {message: msg ? msg : 'Trustline creation failed!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)

      print(error.detail, error)
    }


    // ---------------------------------------------------------------------------------------------------
    function delete_trust_execute(){
      btn_disable('btn_untrust')
      spinner_enable('spinner_untrust')

      let account_seed = doc.querySelector('#input_untrust_seed').value
      let account_id
      try{
        account_id = StellarSdk.Keypair.fromSeed(account_seed).accountId()
      }catch(error){
        delete_trust_error(error, 'Error: invalid secret seed')
        return
      }
      account_seed = undefined

      HORIZON.loadAccount(account_id).then(delete_trust_callback)
    }

    function delete_trust_callback(account){
      account = new StellarSdk.Account(account.id, account.sequence)
      let account_seed = doc.querySelector('#input_untrust_seed').value
      let asset_code = doc.querySelector('#input_untrust_code').value
      let asset_issuer = doc.querySelector('#input_untrust_issuer').value

      if(asset_code.length == 0){
        account_seed = undefined
        error = 'Error: asset code can\'t be null'
        delete_trust_error(error, error)
        return
      }

      let asset
      try{
        asset = new StellarSdk.Asset(asset_code, asset_issuer)
      }
      catch(error){
        delete_trust_error(error, error)
        account_seed = undefined
      }

      try{
        delete_trust(account, account_seed, asset)
        account_seed = undefined
      }catch(error){
        generic_error_snackbar_show(error)
        btn_enable('btn_untrust')
        spinner_disable('spinner_untrust')
      }

    }

    function delete_trust(account, account_seed, asset){
      let tx = {asset: asset, limit: '0'}
      let operation = StellarSdk.Operation.changeTrust(tx)
      let transaction = new StellarSdk.TransactionBuilder(account).addOperation(operation).build()  // 1. Build transaction!
      transaction.sign(StellarSdk.Keypair.fromSeed(account_seed))  // 2. Sign transaction!
      HORIZON.submitTransaction(transaction).then(delete_trust_success).catch(delete_trust_error)  // 3. Submit transaction!
      account_seed = undefined
    }

    function delete_trust_success(operation){
      btn_enable('btn_untrust')
      spinner_disable('spinner_untrust')

      let snackbar_div = doc.querySelector('#snackbar_success')
      let snackbar_data = {message: 'Trustline deleted!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)
      doc.querySelector('#input_untrust_seed').value = ''

      print(arguments.callee.name, operation)
    }

    function delete_trust_error(error, msg){
      btn_enable('btn_untrust')
      spinner_disable('spinner_untrust')

      let snackbar_div = doc.querySelector('#snackbar_error')
      let snackbar_data = {message: msg ? msg : 'Trustline deletion failed!'}
      snackbar_div.MaterialSnackbar.showSnackbar(snackbar_data)

      print(error.detail, error)
    }


    // ---------------------------------------------------------------------------------------------------
    doc.querySelector('#btn_payment_xlm').onclick = function(event){
      payment_xlm_execute()
    }

    doc.querySelector('#input_payment_destination').onkeypress = function(event){
      if(event.keyCode == 13)  payment_xlm_execute()
    }
    doc.querySelector('#input_payment_amount').onkeypress = function(event){
      if(event.keyCode == 13)  payment_xlm_execute()
    }
    doc.querySelector('#input_payment_seed').onkeypress = function(event){
      if(event.keyCode == 13)  payment_xlm_execute()
    }


    // ---------------------------------------------------------------------------------------------------
    doc.querySelector('#btn_payment_asset').onclick = function(event){
      payment_asset_execute()
    }

    doc.querySelector('#input_payment_asset_destination').onkeypress = function(event){
      if(event.keyCode == 13)  payment_asset_execute()
    }
    doc.querySelector('#input_payment_asset_code').onkeypress = function(event){
      if(event.keyCode == 13)  payment_asset_execute()
    }
    doc.querySelector('#input_payment_asset_issuer').onkeypress = function(event){
      if(event.keyCode == 13)  payment_asset_execute()
    }
    doc.querySelector('#input_payment_asset_amount').onkeypress = function(event){
      if(event.keyCode == 13)  payment_asset_execute()
    }
    doc.querySelector('#input_payment_asset_seed').onkeypress = function(event){
      if(event.keyCode == 13)  payment_asset_execute()
    }


    // ---------------------------------------------------------------------------------------------------
    doc.querySelector('#btn_trust').onclick = function(event){
      create_trust_execute()
    }

    doc.querySelector('#input_trust_code').onkeypress = function(event){
      if(event.keyCode == 13)  create_trust_execute()
    }
    doc.querySelector('#input_trust_issuer').onkeypress = function(event){
      if(event.keyCode == 13)  create_trust_execute()
    }
    doc.querySelector('#input_trust_seed').onkeypress = function(event){
      if(event.keyCode == 13)  create_trust_execute()
    }


    // ---------------------------------------------------------------------------------------------------
    doc.querySelector('#btn_untrust').onclick = function(event){
      delete_trust_execute()
    }

    doc.querySelector('#input_untrust_code').onkeypress = function(event){
      if(event.keyCode == 13)  delete_trust_execute()
    }
    doc.querySelector('#input_untrust_issuer').onkeypress = function(event){
      if(event.keyCode == 13)  delete_trust_execute()
    }
    doc.querySelector('#input_untrust_seed').onkeypress = function(event){
      if(event.keyCode == 13)  delete_trust_execute()
    }


    // ---------------------------------------------------------------------------------------------------
    horizon_btn()
  </script>

</html>
